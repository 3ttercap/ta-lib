import chai from 'chai'
const { assert } = chai

import dema from './index'

export default () => {
  describe('Input', () => {
    it('should throw error with wrong timeperiod param', () => {
      assert.throws(dema.bind(null, [], null), Error, 'Timeperiod should be a number!')
    })
    it('should throw error with wrong values', () => {
      assert.throws(dema.bind(null, [null], 1), Error, 'Input value should be a number!')
    })
  })
  describe('output', () => {
    let input = [45.73, 46.14, 46.36, 46.85, 46.92, 47.23, 46.86, 47.45, 47.61, 46.59, 46.9, 47.42, 47.58, 47.58, 48.01, 48.3, 48.72, 47.63, 47.35, 47.37, 47.75, 46.7, 46.28, 47.6, 48.24, 48.66, 48.64, 49.06, 49.16, 48.03, 47.87, 43.34, 42.99, 42.64, 42.91, 41.62, 42.16, 42.26, 41.65, 41.76, 41.72, 41.48, 41.42, 41.53, 41.55, 40.29, 40.72, 40.66, 40.96, 40.97, 41.21, 41.46, 42.9, 42.86, 42.88, 42.29, 42.5, 41.7, 41.56]
    let output = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, 47.1744312307, 47.2857419787, 47.5546510474, 47.8826947936, 48.1302836346, 48.4389056181, 48.7029744793, 48.5819119603, 48.4367272701, 47.0327375861, 45.8407038458, 44.8203553372, 44.1148903023, 43.2148853885, 42.6861271866, 42.3234984814, 41.8891075510, 41.6036771794, 41.3916547908, 41.1794575826, 41.0176014138, 40.9424830583, 40.9082862936, 40.5411208870, 40.3944256340, 40.2800597871, 40.2923763159, 40.3198366397, 40.4230517439, 40.5865832270, 41.1333345675, 41.5552492061, 41.8938922502, 41.9921185185, 42.1291416213, 42.0088056980, 41.8755757009]
    let result = dema(input, 12)
    it('should return an array', () => {
      assert.isTrue(Array.isArray(result))
    })
    it('should return correct values', () => {
      for (let i = 0; i < input.length; ++i) {
        let delta = Math.abs(result[i] - output[i])
        let equal = isNaN(delta) ? true : delta < 0.0001
        assert.isTrue(equal)
      }
    })
    it('should skip NaN', () => {
      let input = [NaN, 45.73, 46.14, 46.36, 46.85, 46.92, 47.23, 46.86, 47.45, 47.61, 46.59, 46.9, 47.42, 47.58, 47.58, 48.01, 48.3, 48.72, 47.63, 47.35, 47.37, 47.75, 46.7, 46.28, 47.6, 48.24, 48.66, 48.64, 49.06, 49.16, 48.03, 47.87, 43.34, 42.99, 42.64, 42.91, 41.62, 42.16, 42.26, 41.65, 41.76, 41.72, 41.48, 41.42, 41.53, 41.55, 40.29, 40.72, 40.66, 40.96, 40.97, 41.21, 41.46, 42.9, 42.86, 42.88, 42.29, 42.5, 41.7, 41.56]
      let output = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, 47.1744312307, 47.2857419787, 47.5546510474, 47.8826947936, 48.1302836346, 48.4389056181, 48.7029744793, 48.5819119603, 48.4367272701, 47.0327375861, 45.8407038458, 44.8203553372, 44.1148903023, 43.2148853885, 42.6861271866, 42.3234984814, 41.8891075510, 41.6036771794, 41.3916547908, 41.1794575826, 41.0176014138, 40.9424830583, 40.9082862936, 40.5411208870, 40.3944256340, 40.2800597871, 40.2923763159, 40.3198366397, 40.4230517439, 40.5865832270, 41.1333345675, 41.5552492061, 41.8938922502, 41.9921185185, 42.1291416213, 42.0088056980, 41.8755757009]
      let result = dema(input, 12)
      for (let i = 0; i < input.length; ++i) {
        let delta = Math.abs(result[i] - output[i])
        let equal = isNaN(delta) ? true : delta < 0.00001
        assert.isTrue(equal)
      }
    })
  })
}
